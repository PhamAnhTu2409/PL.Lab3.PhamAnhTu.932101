# Лабораторная работа 2 — Локальный чатик

**СТУДЕНТ**: Фам Ань Ту  
**ГРУППА**: 932101  

Это приложение реализует простой **чат-сервер и клиент**, написанные на Go, позволяя пользователям общаться друг с другом через TCP. Ниже представлено объяснение функциональности.

---
### **Как это работает**

#### **1. Режимы работы**
Программа может быть запущена в двух режимах:
- **Режим сервера**: Запускает TCP-сервер для обработки нескольких клиентских подключений.
- **Режим клиента**: Подключается к серверу и позволяет пользователям отправлять/получать сообщения.

Для запуска приложения используются следующие флаги:
- `-mode`: Укажите `server` или `client`.
- `-host`: Определите хост сервера (по умолчанию: `127.0.0.1`).
- `-port`: Укажите номер порта (по умолчанию: `8080`).
- `-username`: Укажите имя пользователя при запуске в режиме клиента.

#### **2. Работа сервера**
1. **Запуск прослушивания**:  
   Сервер слушает входящие подключения на указанном хосте и порту.
2. **Обработка подключений**:  
   Каждое подключение обрабатывается в отдельной goroutine:
   - Считывается имя пользователя, отправленное клиентом.
   - Клиент добавляется в глобальную карту `clients` (потокобезопасная структура с использованием `sync.RWMutex`).
   - Остальные клиенты уведомляются о новом подключении.
3. **Обработка сообщений**:
   - **Рассылка сообщений (Broadcast)**: Сообщения отправляются всем подключённым клиентам, кроме отправителя.
   - **Личные сообщения (Private)**: Сообщения, начинающиеся с `@username`, пересылаются только указанному пользователю.
4. **Отключение клиента**:  
   При отключении клиента он удаляется из карты `clients`, и сервер уведомляет других клиентов.

#### **3. Работа клиента**
1. **Подключение к серверу**:  
   Клиент подключается к серверу и отправляет своё имя пользователя.
2. **Отправка сообщений**:  
   Пользователь может:
   - Отправить сообщение всем (broadcast), просто введя текст и нажав Enter.
   - Отправить личное сообщение с использованием формата `@username message`.
3. **Получение сообщений**:  
   Клиент постоянно слушает входящие сообщения от сервера и отображает их.

#### **4. Формат сообщений**
- **Broadcast**: Сообщения доставляются всем подключённым пользователям. Пример:
```
Tu1: Привет, всем!
```
- **Личное сообщение (Private)**: Сообщения доставляются только указанному пользователю. Пример:
```
[PRIVATE] You to Tu2: Привет, Alice!
```

---

### **Пример использования**

#### **Запуск сервера**
```bash
go run main.go -mode=server
```
```bash
go run main.go -mode=client -username=Tu1
```